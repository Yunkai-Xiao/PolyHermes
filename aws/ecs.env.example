# Copy this file to aws/ecs.env and fill in account-specific values.
# Example:
#   cp aws/ecs.env.example aws/ecs.env
#   ./aws/setup-ecs.sh aws/ecs.env

# ---------------------------
# AWS account / region
# ---------------------------
# Configure credentials via AWS CLI first:
#   aws configure --profile <name>
AWS_PROFILE=
AWS_REGION=eu-west-2

# ---------------------------
# ECR image settings
# ---------------------------
# SOURCE_MODE:
#   local = build Docker image from your local repo changes (recommended for fork/custom code)
#   image = pull existing SOURCE_IMAGE and push to your ECR
SOURCE_MODE=local
ECR_REPOSITORY=polyhermes
LOCAL_IMAGE_NAME=polyhermes-local
SOURCE_IMAGE=wrbug/polyhermes:latest
IMAGE_TAG=latest

# ---------------------------
# ECS settings
# ---------------------------
ECS_CLUSTER_NAME=polyhermes-cluster
ECS_SERVICE_NAME=polyhermes-service
ECS_TASK_FAMILY=polyhermes-task
ECS_DESIRED_COUNT=1

# Fargate CPU/memory must be a valid pair.
# Current default is safer for app + mysql sidecar.
ECS_TASK_CPU=1024
ECS_TASK_MEMORY=2048
ECS_ASSIGN_PUBLIC_IP=ENABLED

# ---------------------------
# Logs
# ---------------------------
CLOUDWATCH_LOG_GROUP=/ecs/polyhermes
CLOUDWATCH_LOG_RETENTION_DAYS=14

# ---------------------------
# IAM role names for ECS task execution
# ---------------------------
ECS_EXECUTION_ROLE_NAME=polyhermes-ecs-exec-role
ECS_TASK_ROLE_NAME=polyhermes-ecs-task-role

# ---------------------------
# Network settings
# ---------------------------
# If SUBNET_IDS is empty and USE_DEFAULT_VPC=true,
# script auto-discovers subnets from default VPC.
USE_DEFAULT_VPC=true
VPC_ID=
# Comma-separated list, example:
# SUBNET_IDS=subnet-aaa,subnet-bbb
SUBNET_IDS=

SECURITY_GROUP_NAME=polyhermes-ecs-sg
SECURITY_GROUP_ID=
HTTP_CIDR=0.0.0.0/0
HTTPS_CIDR=0.0.0.0/0

# ---------------------------
# App runtime settings
# ---------------------------
TZ=Europe/London
SPRING_PROFILES_ACTIVE=prod
SERVER_PORT=80

# IMPORTANT:
# This setup runs MySQL in same ECS task, so DB host is localhost.
DB_URL=jdbc:mysql://127.0.0.1:3306/polyhermes?useSSL=false&serverTimezone=UTC&characterEncoding=utf8&allowPublicKeyRetrieval=true
DB_USERNAME=root

# ---------------------------
# App secrets (dummy generated values)
# Replace before production usage.
# ---------------------------
DB_PASSWORD=6e1cc4cc235f817ed71595838db5ac7d
JWT_SECRET=c32973105f3090d215bcfe2b2a13e6891e6c3ba5d3da5edaf146ed4fffbc7586
ADMIN_RESET_PASSWORD_KEY=0bf8acf1fbf8c01100c4bbb8099cfc62
INITIAL_ADMIN_USERNAME=admin
INITIAL_ADMIN_PASSWORD=jwVXjkdgkWRChtVc+Ybo8ncE

LOG_LEVEL_ROOT=WARN
LOG_LEVEL_APP=INFO
ALLOW_PRERELEASE=false
# Copy-trading short buffer (milliseconds)
COPYTRADING_BUY_SHORT_BUFFER_ENABLED=true
COPYTRADING_BUY_SHORT_BUFFER_WINDOW_MS=120
GITHUB_REPO=Yunkai-Xiao/PolyHermes

# ---------------------------
# MySQL sidecar settings
# ---------------------------
MYSQL_IMAGE=mysql:8.2
MYSQL_DATABASE=polyhermes
MYSQL_CHARACTER_SET_SERVER=utf8mb4
MYSQL_COLLATION_SERVER=utf8mb4_unicode_ci
